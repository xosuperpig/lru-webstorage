!function(t,e,r){var i={local:window.localStorage,session:window.sessionStorage};window.define&&define.cmd?define(function(n,o,s){s.exports=t(i,e(i),r())}):(window.LruWebStorage=t(i,e(i),r()),window.LruWebStorage.CacheItem=e(i),window.LruWebStorage.LRUArray=r())}(function(t,e,r){function i(t,n){this.prefix=t,i.ATTRIBUTES.forEach(function(t){this[t]=n[t]},this),this.lruarray=r("storageKey"),this.lruarray.onSort(function(){for(var t=0;t<this.lruarray.length;t++)this.lruarray.get(t).isStale()?(this.lruarray.remove(t),t--):t<this.limit?this.lruarray.get(t).level="local":this.useSession?this.lruarray.get(t).level="session":(this.lruarray.remove(t),t--)},this),n._items&&n._items.forEach(function(t){var r=new e(t);r.isValid()&&this.lruarray.unshift(r)},this)}return i.ATTRIBUTES=["maxAge","limit","useSession"],i.prototype.set=function(t,r){var i;return this.get(t)?i=this.lruarray.find(t):(i=new e({storageKey:this.prefix+"-"+t,maxAge:Date.now()+this.maxAge,level:"local"}),this.lruarray.unshift(i)),i.val=r,this.saveConfig(),this},i.prototype.get=function(t){var e,r;return t=this.prefix+"-"+t,-1==(r=this.lruarray.indexOf(t))?{}.undefined:(e=this.lruarray.get(r),e.isStale()?(this.lruarray.remove(r),null):e.val)},i.prototype.saveConfig=function(){var e={_items:[]};this.lruarray.forEach(function(t){e._items.push(t.toJSON())},this),i.ATTRIBUTES.forEach(function(t){e[t]=this[t]},this),t.local.setItem(this.prefix+"-lruconfig",JSON.stringify(e))},function(e,r){var n=t.local.getItem(e+"-lruconfig")?JSON.parse(t.local.getItem(e+"-lruconfig")):{};return r=r||{},n.maxAge=r.maxAge||n.maxAge||1/0,n.limit=r.limit||n.limit||0,n.useSession="useSession"in r?r.useSession:"useSession"in n?n.useSession:!0,n.onStale=r.onStale||null,new i(e,n)}},function(t){function e(r){Object.keys(e.DESCRIPTORS).forEach(function(t){Object.defineProperty(this,t,e.DESCRIPTORS[t](r))},this),Object.defineProperty(this,"val",{set:function(e){this.lastuse=Date.now(),t[this.level].setItem(this.storageKey,JSON.stringify(e))},get:function(){return this.lastuse=Date.now(),JSON.parse(t[this.level].getItem(this.storageKey))}})}return e.DESCRIPTORS={storageKey:function(t){if(!t.storageKey&&!t.key)throw"CacheItem must has a storageKey";return{value:t.storageKey||t.key}},maxAge:function(t){return{value:t.maxAge||1/0}},level:function(t){var e="session"!=t.level&&"local"!=t.level?"session":t.level;return{set:function(t){if(e&&("local"==t||"session"==t)&&e!=t){var r=this.destroy();e=t,this.val=r}},get:function(){return e}}},lastuse:function(t){var e=t.lastuse||Date.now();return{set:function(t){e=t},get:function(){return e}}}},e.prototype.toJSON=function(){var t={};return Object.keys(e.DESCRIPTORS).forEach(function(e){t[e]=this[e]},this),JSON.stringify(t)},e.prototype.isStale=function(){return Date.now()>this.maxAge},e.prototype.isValid=function(){return!!this.val},e.prototype.destroy=function(){var e=this.val;return t[this.level].removeItem(this.storageKey,e),e},e},function(){function t(t){this.arr=[],this.idkey="function"==typeof t?t:function(e){return e[t]};var e=this;Object.defineProperty(this,"length",{get:function(){return e.arr.length},set:function(){}}),this.sortTimer=null}return["forEach","every"].forEach(function(e){t.prototype[e]=function(){return this.arr[e].apply(this.arr,arguments)}}),["push","shift","unshift","pop","concat"].forEach(function(e){t.prototype[e]=function(){return this.resort(),this.arr[e].apply(this.arr,arguments)}}),t.prototype.remove=function(t){this.arr.splice(t,1)},t.prototype.get=function(t){return this.arr[t]},t.prototype.indexOf=function(t){var e=-1;return this.every(function(r,i){return this.idkey(r)==t?(e=i,!1):!0},this),this.resort(),e},t.prototype.find=function(t){var e=this.indexOf(t),r=this.arr[e];return r},t.prototype.resort=function(){var t=this;this.sortTimer||(this.sortTimer=setTimeout(function(){t.arr.sort(function(t,e){return e.lastuse-t.lastuse}),t._onSort&&t._onSort(),t.sortTimer=null},0))},t.prototype.onSort=function(t,e){"function"==typeof t&&(this._onSort=function(){t.apply(e,arguments)})},function(e){return new t(e)}});